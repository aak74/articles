# Пользователь в Docker
Если специальным образом не указать пользователя, под которым будут работать процессы в контейнере, то все процессы будут работать из под пользователя root. Это очень удобно, ведь у этого пользователя нет никаких ограничений. И именно поэтому неправильно работать под рутом с точки зрения безопасности. И если на локальном компьютере никто в здравом уме не работает с рутовыми правами, то многие контейнеры запускаются под рутом.

Никакой уровень изоляции не является идеальным. Всегда есть баги, которые могут позволить зловреду выбраться из контейнера и попасть на хостовый компьютер. Предполагая худшее мы должны обеспечить запуск процессов внутри контейнера от пользователя, который не имеет никаких прав на хостовой машине.

## Создание пользователя
Необходимо создать пользователя в контейнере:
Для разных базовых образов команды могут различаться.
Для дистрибутивов основанных на debian:
```Dockerfile
RUN groupadd --gid 2000 node \
  && useradd --uid 2000 --gid node --shell /bin/bash --create-home node
```

Для alpine:
```Dockerfile
RUN addgroup -g 2000 node \
    && adduser -u 2000 -G node -s /bin/sh -D node
```

## Присвоение пользователю UID и GID
Если пользователь создан ранее, но необходимо изменить
```Dockerfile
RUN usermod -u 2000 www-data \
  && groupmod -g 2000 www-data
```

## Запуск процессов от пользователя
Для запуска всех последующих процессов от пользователя с UID 2000 выполните следующее:
```Dockerfile
USER 2000
```
или
```Dockerfile
USER node
```

[Документация](https://docs.docker.com/engine/reference/builder/#user)

## Монтирование томов
При монтирование томов внутрь контейнера необходимо обеспечить пользователю возможность читать файлы и писать. Для этого необходимо обеспечить соответствие UID (GID) пользователя в контейнере и пользователя за пределами контейнера, у которого есть соответствующие права на доступ к файлам.

Часто на линуксовом компьютере у пользователя UID и GID равны 1000. Эти идентификаторы присваиваются первому пользователю компьютера.

Узнать свои идентификаторы просто:
```sh
id
```
Вы получите исчерпывающую информацию о своем пльзователе.

Замените 2000 из примеров на свой идентификатор и все будет в порядке.
Если ваш идентификатор и идентификаторы всех людей, которые работают над проектом совпадают, то этого более чем достаточно. Однако это часто совсем не так.

## Передача идентификатора пользователя внутрь контейнера при построении образа
Многие пользователи docker не задумываются о том, что есть разные этапы жизни образа. Есть построение образа и запуск контейнера из образа.

Создание пользователей должно происходить при построении образа. Это же касается и определения пользователя из под которого запускаются процессы. А это зна
[ENV](https://docs.docker.com/engine/reference/builder/#env)
[ARG](https://docs.docker.com/engine/reference/builder/#arg)
[Более подробная статья](https://vsupalov.com/docker-arg-env-variable-guide/)

docker-compose

<!-- Если это ваш случай, то тут все просто.  -->